{"ast":null,"code":"// src/Chat.js\nimport React,{useEffect,useState}from\"react\";import{auth,db}from\"./firebase\";import{signOut}from\"firebase/auth\";import{doc,getDoc,setDoc}from\"firebase/firestore\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Chat(){const[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const userId=localStorage.getItem(\"userId\");useEffect(()=>{async function loadHistory(){if(!userId)return;try{const docRef=doc(db,\"chats\",userId);const docSnap=await getDoc(docRef);if(docSnap.exists())setMessages(docSnap.data().history);}catch(error){console.error(\"Error loading chat history:\",error);}}loadHistory();},[userId]);const handleSend=async()=>{if(!input.trim())return;try{const res=await fetch(\"http://localhost:5000/chat\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({message:input,user_id:userId})});const data=await res.json();const botResponse=data.response;const updatedMessages=[...messages,{user:input,bot:botResponse}];setMessages(updatedMessages);await setDoc(doc(db,\"chats\",userId),{history:updatedMessages});setInput(\"\");}catch(error){console.error(\"Error sending message:\",error);alert(\"Failed to send message.\");}};const handleLogout=()=>{signOut(auth);localStorage.removeItem(\"userId\");window.location.href=\"/signin\";};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-wrapper d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header d-flex justify-content-between align-items-center p-3\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"m-0 text-white we\",children:\"aug\"}),/*#__PURE__*/_jsx(\"button\",{className:\"logout text-aut btn-light btn-sm \",onClick:handleLogout,children:\"LogOut\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-aut chat-box flex-grow-1 p-3\",children:messages.map((msg,idx)=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"message user-msg\",children:msg.user}),/*#__PURE__*/_jsx(\"div\",{className:\"message bot-msg\",children:msg.bot})]},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-aut chat-input d-flex p-3\",children:[/*#__PURE__*/_jsx(\"input\",{value:input,onChange:e=>setInput(e.target.value),placeholder:\"Type a message...\",onKeyDown:e=>e.key===\"Enter\"&&handleSend(),className:\"form-control me-2\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-aut btn-autumn\",onClick:handleSend,children:\"Send\"})]})]});}export default Chat;","map":{"version":3,"names":["React","useEffect","useState","auth","db","signOut","doc","getDoc","setDoc","jsx","_jsx","jsxs","_jsxs","Chat","messages","setMessages","input","setInput","userId","localStorage","getItem","loadHistory","docRef","docSnap","exists","data","history","error","console","handleSend","trim","res","fetch","method","headers","body","JSON","stringify","message","user_id","json","botResponse","response","updatedMessages","user","bot","alert","handleLogout","removeItem","window","location","href","className","children","onClick","map","msg","idx","value","onChange","e","target","placeholder","onKeyDown","key"],"sources":["C:/Users/devbr/OneDrive/Desktop/August/frontend/src/Chat.js"],"sourcesContent":["// src/Chat.js\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { auth, db } from \"./firebase\";\r\nimport { signOut } from \"firebase/auth\";\r\nimport { doc, getDoc, setDoc } from \"firebase/firestore\";\r\n\r\nfunction Chat() {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const userId = localStorage.getItem(\"userId\");\r\n\r\n  useEffect(() => {\r\n    async function loadHistory() {\r\n      if (!userId) return;\r\n      try {\r\n        const docRef = doc(db, \"chats\", userId);\r\n        const docSnap = await getDoc(docRef);\r\n        if (docSnap.exists()) setMessages(docSnap.data().history);\r\n      } catch (error) {\r\n        console.error(\"Error loading chat history:\", error);\r\n      }\r\n    }\r\n    loadHistory();\r\n  }, [userId]);\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim()) return;\r\n\r\n    try {\r\n      const res = await fetch(\"http://localhost:5000/chat\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ message: input, user_id: userId }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      const botResponse = data.response;\r\n      const updatedMessages = [...messages, { user: input, bot: botResponse }];\r\n\r\n      setMessages(updatedMessages);\r\n      await setDoc(doc(db, \"chats\", userId), { history: updatedMessages });\r\n      setInput(\"\");\r\n    } catch (error) {\r\n      console.error(\"Error sending message:\", error);\r\n      alert(\"Failed to send message.\");\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    signOut(auth);\r\n    localStorage.removeItem(\"userId\");\r\n    window.location.href = \"/signin\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-wrapper d-flex flex-column\">\r\n      <div className=\"chat-header d-flex justify-content-between align-items-center p-3\">\r\n        <h5 className=\"m-0 text-white we\">aug</h5>\r\n        <button className=\"logout text-aut btn-light btn-sm \" onClick={handleLogout}>LogOut</button>\r\n      </div>\r\n\r\n      <div className=\"text-aut chat-box flex-grow-1 p-3\">\r\n        {messages.map((msg, idx) => (\r\n          <div key={idx}>\r\n            <div className=\"message user-msg\">{msg.user}</div>\r\n            <div className=\"message bot-msg\">{msg.bot}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"text-aut chat-input d-flex p-3\">\r\n        <input\r\n          value={input}\r\n          onChange={(e) => setInput(e.target.value)}\r\n          placeholder=\"Type a message...\"\r\n          onKeyDown={(e) => e.key === \"Enter\" && handleSend()}\r\n          className=\"form-control me-2\"\r\n        />\r\n        <button className=\"text-aut btn-autumn\" onClick={handleSend}>Send</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Chat;\r\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,IAAI,CAAEC,EAAE,KAAQ,YAAY,CACrC,OAASC,OAAO,KAAQ,eAAe,CACvC,OAASC,GAAG,CAAEC,MAAM,CAAEC,MAAM,KAAQ,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEzD,QAAS,CAAAC,IAAIA,CAAA,CAAG,CACd,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGb,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACc,KAAK,CAAEC,QAAQ,CAAC,CAAGf,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAAgB,MAAM,CAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAE7CnB,SAAS,CAAC,IAAM,CACd,cAAe,CAAAoB,WAAWA,CAAA,CAAG,CAC3B,GAAI,CAACH,MAAM,CAAE,OACb,GAAI,CACF,KAAM,CAAAI,MAAM,CAAGhB,GAAG,CAACF,EAAE,CAAE,OAAO,CAAEc,MAAM,CAAC,CACvC,KAAM,CAAAK,OAAO,CAAG,KAAM,CAAAhB,MAAM,CAACe,MAAM,CAAC,CACpC,GAAIC,OAAO,CAACC,MAAM,CAAC,CAAC,CAAET,WAAW,CAACQ,OAAO,CAACE,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAC3D,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACrD,CACF,CACAN,WAAW,CAAC,CAAC,CACf,CAAC,CAAE,CAACH,MAAM,CAAC,CAAC,CAEZ,KAAM,CAAAW,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,CAACb,KAAK,CAACc,IAAI,CAAC,CAAC,CAAE,OAEnB,GAAI,CACF,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAC,KAAK,CAAC,4BAA4B,CAAE,CACpDC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEC,OAAO,CAAEtB,KAAK,CAAEuB,OAAO,CAAErB,MAAO,CAAC,CAC1D,CAAC,CAAC,CAEF,KAAM,CAAAO,IAAI,CAAG,KAAM,CAAAM,GAAG,CAACS,IAAI,CAAC,CAAC,CAC7B,KAAM,CAAAC,WAAW,CAAGhB,IAAI,CAACiB,QAAQ,CACjC,KAAM,CAAAC,eAAe,CAAG,CAAC,GAAG7B,QAAQ,CAAE,CAAE8B,IAAI,CAAE5B,KAAK,CAAE6B,GAAG,CAAEJ,WAAY,CAAC,CAAC,CAExE1B,WAAW,CAAC4B,eAAe,CAAC,CAC5B,KAAM,CAAAnC,MAAM,CAACF,GAAG,CAACF,EAAE,CAAE,OAAO,CAAEc,MAAM,CAAC,CAAE,CAAEQ,OAAO,CAAEiB,eAAgB,CAAC,CAAC,CACpE1B,QAAQ,CAAC,EAAE,CAAC,CACd,CAAE,MAAOU,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAC9CmB,KAAK,CAAC,yBAAyB,CAAC,CAClC,CACF,CAAC,CAED,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAM,CACzB1C,OAAO,CAACF,IAAI,CAAC,CACbgB,YAAY,CAAC6B,UAAU,CAAC,QAAQ,CAAC,CACjCC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,SAAS,CAClC,CAAC,CAED,mBACEvC,KAAA,QAAKwC,SAAS,CAAC,iCAAiC,CAAAC,QAAA,eAC9CzC,KAAA,QAAKwC,SAAS,CAAC,mEAAmE,CAAAC,QAAA,eAChF3C,IAAA,OAAI0C,SAAS,CAAC,mBAAmB,CAAAC,QAAA,CAAC,KAAG,CAAI,CAAC,cAC1C3C,IAAA,WAAQ0C,SAAS,CAAC,mCAAmC,CAACE,OAAO,CAAEP,YAAa,CAAAM,QAAA,CAAC,QAAM,CAAQ,CAAC,EACzF,CAAC,cAEN3C,IAAA,QAAK0C,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAC/CvC,QAAQ,CAACyC,GAAG,CAAC,CAACC,GAAG,CAAEC,GAAG,gBACrB7C,KAAA,QAAAyC,QAAA,eACE3C,IAAA,QAAK0C,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAEG,GAAG,CAACZ,IAAI,CAAM,CAAC,cAClDlC,IAAA,QAAK0C,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAEG,GAAG,CAACX,GAAG,CAAM,CAAC,GAFxCY,GAGL,CACN,CAAC,CACC,CAAC,cAEN7C,KAAA,QAAKwC,SAAS,CAAC,gCAAgC,CAAAC,QAAA,eAC7C3C,IAAA,UACEgD,KAAK,CAAE1C,KAAM,CACb2C,QAAQ,CAAGC,CAAC,EAAK3C,QAAQ,CAAC2C,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC1CI,WAAW,CAAC,mBAAmB,CAC/BC,SAAS,CAAGH,CAAC,EAAKA,CAAC,CAACI,GAAG,GAAK,OAAO,EAAInC,UAAU,CAAC,CAAE,CACpDuB,SAAS,CAAC,mBAAmB,CAC9B,CAAC,cACF1C,IAAA,WAAQ0C,SAAS,CAAC,qBAAqB,CAACE,OAAO,CAAEzB,UAAW,CAAAwB,QAAA,CAAC,MAAI,CAAQ,CAAC,EACvE,CAAC,EACH,CAAC,CAEV,CAEA,cAAe,CAAAxC,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}